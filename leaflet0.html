<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css" integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js" integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        #map { height: 800px; }
    </style>
</head>
<body onload="getLocation()">
    leaflet
    <div id="map"></div>


    <script>
        let map = {}
        let locationsList = []

        function getLocation() 
        {
            if (navigator.geolocation) 
            {
                navigator.geolocation.getCurrentPosition(showPosition);
            } 
            else { 
                alert("Geolocation is not supported by this browser.")
            }
        }

        function showPosition(position) 
        {
            let latitude = position.coords.latitude
            let longitude = position.coords.longitude

            map = L.map('map').setView([latitude, longitude], 13);
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            var marker = L.marker([latitude, longitude]).addTo(map);
            marker.bindPopup("<p style=color:red;>You are here</p>").openPopup();

            var popup = L.popup();

            // Script for adding marker on map click
            map.on('click', onMapClick);
        }

        function onMapClick(e) {
            var geojsonFeature = 
            {
                "type": "Feature",
                "properties": {},
                "geometry":
                {
                    "type": "Point",
                    "coordinates": [e.latlng.lat, e.latlng.lng]
                }
            }

            var marker;

            L.geoJson(geojsonFeature, {
                pointToLayer: function(feature, latlng)
                    {
                        marker = L.marker(e.latlng, {
                        title: "Location",
                        alt: "Location",
                        riseOnHover: true,
                        // draggable: true,
                    }).bindPopup("<input type='button' value='Remove' class='marker-delete-button'/>");

                    marker.on("popupopen", onPopupOpen);
                    return marker;
                }
            }).addTo(map);

            // add location to list
            let location = [e.latlng.lat, e.latlng.lng]
            // console.log(location)
            locationsList.push(location)
            // console.log(locationsList)
        }

        // Function to handle delete as well as other events on marker popup open
        function onPopupOpen() {
            var tempMarker = this;
            // console.log(tempMarker)
            // To remove marker on click of delete button in the popup of marker
            $(".marker-delete-button:visible").click(function() {
                map.removeLayer(tempMarker);
                // remove from location list
                let lat = tempMarker["_latlng"].lat
                let long = tempMarker["_latlng"].lng
                let location = [lat, long]
                removeLatLng(location)
            });
        }

        function removeLatLng(location) 
        // gets an array of latitude and longitude [x, y] and removes them from the location list array.
        {
            for (index in locationsList)
            {
                if (locationsList[index][0] == location[0] && locationsList[index][1] == location[1])
                {
                    // remove from array using index
                    if (index > -1)
                    {
                        locationsList.splice(index, 1)
                        console.log(locationsList)
                    }
                }
            }
        }
    </script>
</body>
</html>